<!DOCTYPE html>
<html lang="en">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="PDO提供了许多的方法可以让我们操作数据,主要有:exec(),query(),prepare(),quote(),lastInsertId,setAttribute(),getAttribute(),errorCode(),errorInfo()。">
<meta property="og:type" content="article">
<meta property="og:title" content="PDO方法简单使用">
<meta property="og:url" content="http://yoursite.com/2017/08/15/%E6%8A%80%E6%9C%AF/%E6%9D%82%E8%AE%B0/PHP/PDO%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/PDO%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/index.html">
<meta property="og:site_name" content="THEBLOG">
<meta property="og:description" content="PDO提供了许多的方法可以让我们操作数据,主要有:exec(),query(),prepare(),quote(),lastInsertId,setAttribute(),getAttribute(),errorCode(),errorInfo()。">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2017-08-14T16:00:00.000Z">
<meta property="article:modified_time" content="2020-03-29T15:01:28.287Z">
<meta property="article:author" content="山羁">
<meta property="article:tag" content="PDO">
<meta property="article:tag" content="MYSQL">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/2017/08/15/%E6%8A%80%E6%9C%AF/%E6%9D%82%E8%AE%B0/PHP/PDO%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/PDO%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>PDO方法简单使用 | THEBLOG</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">THEBLOG</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/15/%E6%8A%80%E6%9C%AF/%E6%9D%82%E8%AE%B0/PHP/PDO%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/PDO%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="山羁">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="THEBLOG">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          PDO方法简单使用
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-08-15 00:00:00" itemprop="dateCreated datePublished" datetime="2017-08-15T00:00:00+08:00">2017-08-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-29 23:01:28" itemprop="dateModified" datetime="2020-03-29T23:01:28+08:00">2020-03-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PHP/" itemprop="url" rel="index"><span itemprop="name">PHP</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>PDO提供了许多的方法可以让我们操作数据,主要有:exec(),query(),prepare(),quote(),lastInsertId,setAttribute(),getAttribute(),errorCode(),errorInfo()。</p>
<a id="more"></a>

<h4 id="exec"><a href="#exec" class="headerlink" title="exec()"></a>exec()</h4><p>执行一条SQL语句，并返回受其影响的条数</p>
<blockquote>
<p><code>PDO::exec()</code> executes an SQL statement in a single function call, returning the number of rows affected by the statement.<br><code>PDO::exec()</code> does not return results from a <code>SELECT</code> statement. For a SELECT statement that you only need to issue once during your program, consider issuing <code>PDO::query()</code>. For a statement that you need to issue multiple times, prepare a PDOStatement object with <code>PDO::prepare()</code> and issue the statement with <code>PDOStatement::execute()</code>.</p>
</blockquote>
<p>返回值</p>
<blockquote>
<p><code>PDO::exec()</code> returns the number of rows that were modified or deleted by the SQL statement you issued. If no rows were affected, <code>PDO::exec()</code> returns 0.</p>
</blockquote>
<p>实例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">&lt;&lt;&lt;EOF</span></span><br><span class="line"><span class="string">    //your sql here</span></span><br><span class="line"><span class="string">EOF;</span></span><br><span class="line">   $res=$pdo-&gt;exec($sql);</span><br><span class="line">   <span class="keyword">echo</span> $res;</span><br></pre></td></tr></table></figure>
<h4 id="errorCode-amp-amp-errorInfo"><a href="#errorCode-amp-amp-errorInfo" class="headerlink" title="errorCode()&amp;&amp;errorInfo()"></a>errorCode()&amp;&amp;errorInfo()</h4><blockquote>
<p>PDO::errorCode() only retrieves error codes for operations performed directly on the database handle. If you create a PDOStatement object through PDO::prepare() or PDO::query() and invoke an error on the statement handle, PDO::errorCode() will not reflect that error. You must call PDOStatement::errorCode() to return the error code for an operation performed on a particular statement handle.</p>
</blockquote>
<p>也就是说，errorCode仅仅返回直接作用于数据库的语句产生的错误码，如果想要得到由prepare、query等statement产生的错误码，应该使用<code>PDOStatement::errorCode()</code></p>
<blockquote>
<p>PDO::errorInfo() returns an array of error information about the last operation performed by this database handle. </p>
</blockquote>
<p>errorInfo返回的则是包含具体语法错误的数组，如果想要获取详细的报错信息，可以使用该方法。</p>
<h4 id="query"><a href="#query" class="headerlink" title="query()"></a>query()</h4><blockquote>
<p>PDO::query — Executes an SQL statement, returning a result set as a PDOStatement object</p>
</blockquote>
<p>实例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFruit</span><span class="params">($conn)</span> </span>&#123;</span><br><span class="line">    $sql = <span class="string">'SELECT name, color, calories FROM fruit ORDER BY name'</span>;</span><br><span class="line">    <span class="keyword">foreach</span> ($conn-&gt;query($sql) <span class="keyword">as</span> $row) &#123;</span><br><span class="line">        <span class="keyword">print</span> $row[<span class="string">'name'</span>] . <span class="string">"\t"</span>;</span><br><span class="line">        <span class="keyword">print</span> $row[<span class="string">'color'</span>] . <span class="string">"\t"</span>;</span><br><span class="line">        <span class="keyword">print</span> $row[<span class="string">'calories'</span>] . <span class="string">"\n"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="setAttribute"><a href="#setAttribute" class="headerlink" title="setAttribute"></a>setAttribute</h4><p>设置连接属性，比如自动提交，错误模式、预处理语句的模拟等，相应的配置可以由<code>getAttribute()</code>方法获得。<br>相关属性见<a href="http://php.net/manual/zh/pdo.setattribute.php" target="_blank" rel="noopener">PDO::setSttribute</a></p>
<h4 id="quote"><a href="#quote" class="headerlink" title="quote()"></a>quote()</h4><p><code>Syntax:public string PDO::quote ( string $string [, int $parameter_type = PDO::PARAM_STR ] )</code></p>
<blockquote>
<p>PDO::quote() places quotes around the input string (if required) and escapes special characters within the input string, using a quoting style appropriate to the underlying driver.<br>If you are using this function to build SQL statements, you are strongly recommended to use PDO::prepare() to prepare SQL statements with bound parameters instead of using PDO::quote() to interpolate user input into an SQL statement. Prepared statements with bound parameters are not only more portable, more convenient, immune to SQL injection, but are often much faster to execute than interpolated queries, as both the server and client side can cache a compiled form of the query.</p>
</blockquote>
<p>也就是说，该方法接收字符串类型的sql语句并进行处理，返回处理后的结果。但是官方提醒是不建议使用，请使用prepare，因为prepare “not only more portable, more convenient, immune to SQL injection, but are often much faster to execute than interpolated queries”。</p>
<h4 id="prepare"><a href="#prepare" class="headerlink" title="prepare()"></a>prepare()</h4><p><code>public PDOStatement PDO::prepare ( string $statement [, array $driver_options = array() ] )</code><br>这可能是最常用的方法了，准备一条执行语句，返回statement对象或者在准备出错时返回false;</p>
<blockquote>
<p>Prepares an SQL statement to be executed by the PDOStatement::execute() method. The SQL statement can contain zero or more named (:name) or question mark (?) parameter markers for which real values will be substituted when the statement is executed. You cannot use both named and question mark parameter markers within the same SQL statement; pick one or the other parameter style. Use these parameters to bind any user-input, do not include the user-input directly in the query.<br>You must include a unique parameter marker for each value you wish to pass in to the statement when you call PDOStatement::execute(). You cannot use a named parameter marker of the same name more than once in a prepared statement, unless emulation mode is on.</p>
</blockquote>
<p>就是说，在同一条sql语句中，“:name”和“？”不能同时出现，如果使用”:name”，那么同一个名字不能出现两次，除非枚举模式开启。<br>实例1：使用”:name”</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/* Execute a prepared statement by passing an array of values */</span></span><br><span class="line">$sql = <span class="string">'SELECT name, colour, calories</span></span><br><span class="line"><span class="string">    FROM fruit</span></span><br><span class="line"><span class="string">    WHERE calories &lt; :calories AND colour = :colour'</span>;</span><br><span class="line">$sth = $dbh-&gt;prepare($sql, <span class="keyword">array</span>(PDO::ATTR_CURSOR =&gt; PDO::CURSOR_FWDONLY));</span><br><span class="line">$sth-&gt;execute(<span class="keyword">array</span>(<span class="string">':calories'</span> =&gt; <span class="number">150</span>, <span class="string">':colour'</span> =&gt; <span class="string">'red'</span>));</span><br><span class="line">$red = $sth-&gt;fetchAll();</span><br><span class="line">$sth-&gt;execute(<span class="keyword">array</span>(<span class="string">':calories'</span> =&gt; <span class="number">175</span>, <span class="string">':colour'</span> =&gt; <span class="string">'yellow'</span>));</span><br><span class="line">$yellow = $sth-&gt;fetchAll();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>实例2：使用”?”</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Execute a prepared statement by passing an array of values */</span></span><br><span class="line">$sth = $dbh-&gt;prepare(<span class="string">'SELECT name, colour, calories</span></span><br><span class="line"><span class="string">    FROM fruit</span></span><br><span class="line"><span class="string">    WHERE calories &lt; ? AND colour = ?'</span>);</span><br><span class="line">$sth-&gt;execute(<span class="keyword">array</span>(<span class="number">150</span>, <span class="string">'red'</span>));</span><br><span class="line">$red = $sth-&gt;fetchAll();</span><br><span class="line"><span class="comment">//or you can use $red = $sth-&gt;fetchAll(PDO::FETCH_ASSOC), which will return an object</span></span><br><span class="line"><span class="comment">//you also use $res-&gt;setFetchMode(PDO::FETCH_ASSOC) to get an object</span></span><br><span class="line">$sth-&gt;execute(<span class="keyword">array</span>(<span class="number">175</span>, <span class="string">'yellow'</span>));</span><br><span class="line">$yellow = $sth-&gt;fetchAll();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>我更喜欢用第二种方式,毕竟。。。命名可是软件工程的三大难题之一呵呵</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/PDO/" rel="tag"># PDO</a>
              <a href="/tags/MYSQL/" rel="tag"># MYSQL</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2017/08/14/%E6%8A%80%E6%9C%AF/%E6%9D%82%E8%AE%B0/php%E9%85%8D%E7%BD%AE%E6%94%AF%E6%8C%81%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0/" rel="prev" title="配置php.ini以及文件夹权限使nginx支持图片上传">
      <i class="fa fa-chevron-left"></i> 配置php.ini以及文件夹权限使nginx支持图片上传
    </a></div>
      <div class="post-nav-item">
    <a href="/2017/08/16/%E6%8A%80%E6%9C%AF/%E6%9D%82%E8%AE%B0/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/JavaScript/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/" rel="next" title="JavaScript设计模式--策略模式">
      JavaScript设计模式--策略模式 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#exec"><span class="nav-number">1.</span> <span class="nav-text">exec()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#errorCode-amp-amp-errorInfo"><span class="nav-number">2.</span> <span class="nav-text">errorCode()&amp;&amp;errorInfo()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#query"><span class="nav-number">3.</span> <span class="nav-text">query()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#setAttribute"><span class="nav-number">4.</span> <span class="nav-text">setAttribute</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#quote"><span class="nav-number">5.</span> <span class="nav-text">quote()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#prepare"><span class="nav-number">6.</span> <span class="nav-text">prepare()</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">山羁</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">45</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">山羁</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->




  















  

  

  

</body>
</html>
